#include <stdio.h>
#include <string.h>
struct {int to,next,dis;}g[400001];int tn,totg,n,m,d[100001],tim[100001],now,to,Q[100001],top,i,j,x,y,z,hasres,visit[100001];long long res;inline void addedge(int u,int v,int dis){totg++;g[totg].to = v;g[totg].dis = dis;g[totg].next = g[u].next;g[u].next = totg;}inline int SPFA(){top = -1;memset(visit,0,sizeof(visit));memset(d,127,sizeof(d));memset(tim,0,sizeof(tim));d[0] = 0;top++;Q[top] = 0;visit[0] = 1;for (;top >=0;){now = Q[top];top--;tim[now]++;if (tim[now] == tn)  return 0;visit[now] = 0;for (i = g[now].next;i != -1;i = g[i].next){to = g[i].to;if (d[to] > d[now]+g[i].dis){d[to] = d[now]+g[i].dis;if (visit[to] == 0){visit[to] = 1;top++;Q[top] = to;}}}}return 1;}int wg;char ch;inline int readint(){ch = getchar();while (ch < '0' || ch > '9')    ch = getchar();wg = ch-'0';ch = getchar();while (ch >= '0' && ch <= '9'){wg = wg*10+ch-'0';ch = getchar();}return wg;}int main(){for (;scanf("%d%d",&n,&m) != EOF;){totg = n;tn = (n*3)/4;for (i = 0;i <= n;i++)  g[i].next = -1;for (i = 1;i <= n;i++)  addedge(0,i,-1);for (i = 1;i <= m;i++){x = readint();y = readint();z = readint();if (x == 1){addedge(y,z,0);addedge(z,y,0);}else if (x == 2)addedge(y,z,-1);else if (x == 3)addedge(z,y,0);else if (x == 4)addedge(z,y,-1);else addedge(y,z,0);}hasres = SPFA();if (hasres == 1){res = 0;for (i = 1;i <= n;i++)res += (long long)(-d[i]);printf("%lld\n",res);}else printf("-1\n");}}
